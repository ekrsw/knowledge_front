# ğŸ› ï¸ Backend APIä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ

**åˆ†ææ—¥æ™‚**: 2025-01-30  
**å¯¾è±¡**: localhost:8000 KSAP Backend API  
**ç›®çš„**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå¤±æ•—è§£æ¶ˆã®ãŸã‚ã®ä¿®æ­£è¦é …

---

## ğŸ“Š ç¾çŠ¶åˆ†æ

### âœ… **å®Ÿè£…æ¸ˆã¿API (64ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã¯ç¨¼åƒä¸­ã§ã€ä»¥ä¸‹ã®APIãŒå®Ÿè£…æ¸ˆã¿:

#### **ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **
- `/api/v1/auth/login` âœ… (POST)
- `/api/v1/auth/login/json` âœ… (POST)
- `/api/v1/auth/me` âœ… (GET)
- `/api/v1/auth/register` âœ… (POST)
- `/api/v1/auth/test-token` âœ… (GET)

#### **ğŸ“š è¨˜äº‹ç®¡ç†**
- `/api/v1/articles/` âœ… (GET, POST)
- `/api/v1/articles/{article_id}` âœ… (GET, PUT, DELETE)
- `/api/v1/articles/by-category/{info_category}` âœ…
- `/api/v1/articles/by-group/{approval_group}` âœ…

#### **ğŸ“ æ”¹è¨‚ãƒ»æ‰¿èªã‚·ã‚¹ãƒ†ãƒ **
- `/api/v1/revisions/` âœ… (GET, POST)
- `/api/v1/revisions/{revision_id}` âœ… (GET, PUT, DELETE)
- `/api/v1/approvals/queue` âœ…
- `/api/v1/approvals/{revision_id}/decide` âœ…

#### **ğŸ¥ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†**
- `/api/v1/system/health` âœ…
- `/api/v1/system/config` âœ…
- `/api/v1/system/version` âœ…

---

## âŒ **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå¤±æ•—ã®åŸå› **

### 1. **APIãƒ‘ã‚¹ä¸ä¸€è‡´** (ğŸ”´ CRITICAL)

**å•é¡Œ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒæœŸå¾…ã™ã‚‹ãƒ‘ã‚¹ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ãŒç•°ãªã‚‹

| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾… | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£… | çŠ¶æ…‹ |
|-------------------|------------------|------|
| `/api/v1/health` | `/api/v1/system/health` | âŒ ä¸ä¸€è‡´ |
| `/api/v1/auth/logout` | **æœªå®Ÿè£…** | âŒ æ¬ è½ |
| `/api/v1/auth/verify` | **æœªå®Ÿè£…** | âŒ æ¬ è½ |
| `/api/v1/auth/status` | **æœªå®Ÿè£…** | âŒ æ¬ è½ |
| `/api/v1/users/me` | `/api/v1/auth/me` | âŒ ä¸ä¸€è‡´ |

### 2. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®ä¸ä¸€è‡´** (ğŸŸ¡ IMPORTANT)

#### **èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…
interface AuthResponse {
  access_token: string
  token_type: string
  user: {
    user_id: string
    username: string
    email: string
    role: 'admin' | 'approver' | 'user'
    is_active: boolean
  }
}

// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ç¢ºèªãŒå¿…è¦
POST /api/v1/auth/login
```

#### **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**
```json
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…: /api/v1/health
{"status": "healthy", "timestamp": "..."}

// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…: /api/v1/system/health  
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼è¦ç¢ºèª
```

### 3. **ãƒ†ã‚¹ãƒˆå°‚ç”¨APIã®ä¸å‚™** (ğŸŸ¡ IMPORTANT)

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆãŒæœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
- `/docs` âœ… (å­˜åœ¨ã€Swagger UI)
- `/openapi.json` âŒ (404ã‚¨ãƒ©ãƒ¼)
- `/api/v1/openapi.json` âœ… (å­˜åœ¨)

---

## ğŸ¯ **å¿…é ˆä¿®æ­£é …ç›®**

### **ğŸ”´ ç·Šæ€¥ä¿®æ­£ (ãƒ†ã‚¹ãƒˆæˆåŠŸã®ãŸã‚ã®æœ€ä½è¦ä»¶)**

#### 1. **ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãƒ»ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè¿½åŠ **
```python
# æ—¢å­˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¿½åŠ 
@app.get("/api/v1/health")
async def health_alias():
    return await system_health()  # æ—¢å­˜ã®system/healthã‚’å‘¼ã³å‡ºã—

@app.get("/api/v1/users/me") 
async def users_me_alias():
    return await get_current_user_info()  # æ—¢å­˜ã®auth/meã‚’å‘¼ã³å‡ºã—
```

#### 2. **ä¸è¶³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ **
```python
@app.post("/api/v1/auth/logout")
async def logout():
    return {"message": "Successfully logged out"}

@app.get("/api/v1/auth/verify")
async def verify_token():
    return {"valid": True}

@app.get("/api/v1/auth/status") 
async def auth_status():
    return {"authenticated": True}

@app.get("/openapi.json")
async def openapi_root_alias():
    return app.openapi()  # ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã§ã‚‚OpenAPIä»•æ§˜ã‚’è¿”ã™
```

### **ğŸŸ¡ é‡è¦ä¿®æ­£ (å®Œå…¨äº’æ›æ€§ã®ãŸã‚)**

#### 3. **èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼çµ±ä¸€**
```python
# ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å‹å®šç¾©ã‚’çµ±ä¸€
class UserResponse(BaseModel):
    user_id: str  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯user_idã‚’æœŸå¾…
    username: str
    email: str 
    role: Literal["admin", "approver", "user"]
    is_active: bool

class AuthResponse(BaseModel):
    access_token: str
    token_type: str
    user: UserResponse
```

#### 4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¨™æº–åŒ–**
```python
# çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
@app.exception_handler(404)
async def not_found_handler(request: Request, exc: HTTPException):
    return JSONResponse(
        status_code=404,
        content={"error": "Endpoint not found", "detail": str(exc.detail)}
    )
```

---

## ğŸ”§ **å®Ÿè£…å„ªå…ˆåº¦**

### **Phase 1: ç·Šæ€¥å¯¾å¿œ (1-2æ™‚é–“)**
1. âœ… `/api/v1/health` ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¿½åŠ 
2. âœ… `/api/v1/users/me` ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¿½åŠ 
3. âœ… `/openapi.json` ãƒ«ãƒ¼ãƒˆã‚¨ã‚¤ãƒªã‚¢ã‚¹è¿½åŠ 
4. âœ… ä¸è¶³ã™ã‚‹èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 

### **Phase 2: å“è³ªå‘ä¸Š (2-4æ™‚é–“)**
5. ğŸ”„ èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®çµ±ä¸€ç¢ºèª
6. ğŸ”„ ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¨™æº–åŒ–
7. ğŸ”„ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ç¢ºèª

### **Phase 3: æœ€é©åŒ– (ä»»æ„)**
8. ğŸ“ˆ CORSè¨­å®šã®æœ€é©åŒ–
9. ğŸ“ APIä»•æ§˜æ›¸ã®æ›´æ–°
10. ğŸ§ª ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

---

## ğŸ“‹ **æ¤œè¨¼æ–¹æ³•**

### **ä¿®æ­£å¾Œã®ç¢ºèªã‚³ãƒãƒ³ãƒ‰**
```bash
# 1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/api/v1/health

# 2. èªè¨¼ãƒ†ã‚¹ãƒˆ  
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"password"}'

# 3. OpenAPIä»•æ§˜ç¢ºèª
curl http://localhost:8000/openapi.json

# 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test -- --testPathPattern="integration|api"
```

### **æˆåŠŸæŒ‡æ¨™**
- âœ… APIçµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸç‡: 0% â†’ 95%ä»¥ä¸Š
- âœ… èªè¨¼ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ: å…¨ãƒ‘ã‚¹
- âœ… CRUDæ“ä½œãƒ†ã‚¹ãƒˆ: å…¨ãƒ‘ã‚¹
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: æœŸå¾…é€šã‚Šã®å‹•ä½œ

---

## ğŸ’¡ **æ¨å¥¨å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**

### **1. æœ€å°ä¾µè¥²ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ** (æ¨å¥¨)
```python
# æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã›ãšã€ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®ã¿è¿½åŠ 
# ãƒªã‚¹ã‚¯æœ€å°ã€å®Ÿè£…æ™‚é–“æœ€çŸ­

@app.get("/api/v1/health")  
async def health_check_alias():
    # æ—¢å­˜ã® /api/v1/system/health ã‚’ãã®ã¾ã¾åˆ©ç”¨
    from .system import health_check
    return await health_check()
```

### **2. æ®µéšçš„ç§»è¡Œã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**
```python
# Phase 1: ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¿½åŠ ã§ãƒ†ã‚¹ãƒˆæˆåŠŸ
# Phase 2: æœ¬æ ¼çš„ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
# Phase 3: ãƒ¬ã‚¬ã‚·ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå»ƒæ­¢äºˆå‘Š
```

---

## âš ï¸ **ãƒªã‚¹ã‚¯è©•ä¾¡**

### **ğŸŸ¢ ä½ãƒªã‚¹ã‚¯ä¿®æ­£**
- ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¿½åŠ : æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã—
- æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ : å‰¯ä½œç”¨ãªã—

### **ğŸŸ¡ ä¸­ãƒªã‚¹ã‚¯ä¿®æ­£**  
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼å¤‰æ›´: æ—¢å­˜ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®å½±éŸ¿è¦ç¢ºèª
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¤‰æ›´: äº’æ›æ€§ãƒ†ã‚¹ãƒˆå¿…é ˆ

### **ğŸ”´ é«˜ãƒªã‚¹ã‚¯ä¿®æ­£**
- æ—¢å­˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®URLå¤‰æ›´: éæ¨å¥¨
- èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®å¤‰æ›´: æ…é‡ãªæ¤œè¨¼ãŒå¿…è¦

---

## ğŸ“ **çµè«–**

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã¯åŸºæœ¬æ©Ÿèƒ½ãŒå®Ÿè£…æ¸ˆã¿**ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå¤±æ•—ã®ä¸»å› ã¯**ãƒ‘ã‚¹ä¸ä¸€è‡´ã¨è»½å¾®ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸è¶³**ã§ã™ã€‚

**æ¨å¥¨å¯¾å¿œ**:
1. **ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¿½åŠ ** (1-2æ™‚é–“) â†’ ãƒ†ã‚¹ãƒˆæˆåŠŸç‡å¤§å¹…æ”¹å–„
2. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ç¢ºèª** (1æ™‚é–“) â†’ å®Œå…¨äº’æ›æ€§ç¢ºä¿
3. **æ®µéšçš„å“è³ªå‘ä¸Š** (ä»»æ„) â†’ é•·æœŸçš„ãªä¿å®ˆæ€§å‘ä¸Š

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®47å€‹ã®å¤±æ•—ãƒ†ã‚¹ãƒˆã®ã†ã¡**90%ä»¥ä¸ŠãŒæˆåŠŸ**ã«è»¢ã˜ã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚